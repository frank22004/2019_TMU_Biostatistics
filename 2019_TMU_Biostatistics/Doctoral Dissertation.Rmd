---
title: "Doctoral Dissertation"
author: "Frank"
date: "`r Sys.Date()`"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

### 1. Loading and following packages, Set up the connection:

```{r librarty, warning=FALSE, echo = FALSE}
library(RODBC)
library(UsingR)
library(ggpubr)
library(ggplot2)
library(ggsignif)
library(dplyr)
library(ggeasy)
library(ggplot2)
library(rstatix)
library(stringr)
library(fitdistrplus)
library(knitr)
library(multcomp)
library(xlsx)
library(grid)
library(ggbreak)
library(stats)
library(ggtext)
library(lme4)
library(lmerTest)
library(geepack)
library(robustlmm)
library(lmerTest)
#library(nparLD)
#library(PMCMRplus)
#library(Skillings.Mack)
print(sessionInfo(),locale = FALSE)
```

1.2.  Set up `r DRIVERINFO`` and database path

```{r access_path}
DRIVERINFO <- "Driver={Microsoft Access Driver (*.mdb, *.accdb)};"
MDBPATH <- "E:/OneDrive/文件/TMU-DESKTOP-SF2LD60-Surface-Go-Surface-Go.accdb"
PATH <- paste0(DRIVERINFO, "DBQ=", MDBPATH)
```

1.3.  Establish connection

```{r connection}
channel <- odbcDriverConnect(PATH)
```

##### 1.4.  Load data into R dataframe

```{r Load, echo=TRUE, warning=FALSE}
# Sample from access for stiffness gradient
df <- sqlQuery(channel,"SELECT * FROM CollagenMembrane, AFM WHERE CollagenMembrane.Cantilever=AFM.No;", stringsAsFactors = FALSE)
df_sample <- sqlQuery(channel,"SELECT * FROM Sample, Collagen_Membrane_Preparation WHERE Sample.Scaffolds=Collagen_Membrane_Preparation.識別碼;")
df_dish <- sqlQuery(channel, "SELECT * FROM DishDepth;", stringsAsFactors = FALSE)
df_all <- merge(df,df_sample,by.x="Experiment Sample",by.y = "識別碼",all.x = "TRUE")
df_drug <- sqlQuery(channel, "SELECT * FROM Drug, Material WHERE Drug.Drug = Material.MaterialID;")
df_all_withdrug <- merge(df_all, df_drug,by.x = "GroupName.y", by.y = "ExperimentSample", all.x = "TRUE")
#df_all_withdrug

# WB quantification
df_MMP <- sqlQuery(channel,"SELECT * FROM WB;", stringsAsFactors = FALSE)
df_MMP <- merge(df_MMP,df_sample,by.x="GroupName",by.y = "GroupName",all.x = "TRUE")
df_MMP <- merge(df_MMP,df_drug,by.x = "GroupName", by.y = "ExperimentSample", all.x = "TRUE")
df_MMP$MaterialName <- ifelse(is.na(df_MMP$MaterialName),"Control",df_MMP$MaterialName)
#df_MMP

#Spheroid
df_spheroid <- sqlQuery(channel,"SELECT * FROM Spheroid, Cell WHERE Spheroid.Cell=Cell.識別碼;", stringsAsFactors = FALSE)
df_data_spheroid <- merge(df_spheroid,df_sample,by.x="識別碼.1",by.y = "Cell",all.x = "TRUE")
df_data_spheroid_withdrug <- merge(df_data_spheroid, df_drug,by.x = "GroupName", by.y = "ExperimentSample", all.x = "TRUE")
#df_data_spheroid_withdrug

#Zymography
df_zym <- sqlQuery(channel,"SELECT * FROM Zymography;", stringsAsFactors = FALSE)
df_zym <- merge(df_zym,df_sample,by.x="GroupName",by.y = "GroupName",all.x = "TRUE")
df_zym <- merge(df_zym,df_drug,by.x = "GroupName", by.y = "ExperimentSample", all.x = "TRUE")
df_zym <- subset.data.frame(df_zym, `Group` == "Dish")
#df_zym
```


### 1. Stiffness-Graident

#### 1.1. EDA

```{r}
#Distance related stiffness
df_data <- subset.data.frame( df_all_withdrug, !(is.na(df_all_withdrug$Yasix)) & 
                                df_all_withdrug$Yasix <= 200 &
                                !(is.na(df_all_withdrug$YoungsModulus))&
                                (`Experiment Sample`=="234"   | `Experiment Sample`== "125"|
                                                  `Experiment Sample`== "126"| `Experiment Sample`== "138"|
                                                  `Experiment Sample`== "144"| `Experiment Sample`== "127" | 
                                                  `Experiment Sample`== "128" |  `Experiment Sample`== "109"| 
                                                  `Experiment Sample`== "110" |
                                                  `Experiment Sample`== "225"| `Experiment Sample`== "235" |
                                                  `Experiment Sample`== "223" | `Experiment Sample`== "233"
                                                 | `Experiment Sample`== "230" 
                                                ) | (df_all_withdrug$MaterialName=="DMSO") |
                                                  (df_all_withdrug$MaterialName=="GM6001(Ilomastat)") 
  )
#                             

df_data$MaterialName <- ifelse(is.na(df_data$MaterialName),"Control",df_data$MaterialName)

SynthesisMatrix <- df_data %>%
  group_by(MaterialName,Status.y,Yasix) %>%
#  group_by(Status.y,Centrifuge.RPM,Ingredient) %>%
#  group_by(Status.x) %>%
#   group_by(Status,culture) %>%
#  group_by(Status.y, Yasix) %>%
  summarise(
    count = sum(!is.na(`YoungsModulus`)),
    N = n_distinct(`Experiment Sample`,na.rm = TRUE),
    mean = mean(`YoungsModulus`, na.rm = TRUE),
    sd = sd(`YoungsModulus`, na.rm = TRUE),
    median = median(`YoungsModulus`, na.rm = TRUE),
    IQR = IQR(`YoungsModulus`, na.rm = TRUE),
    se = sd(`YoungsModulus`, na.rm = TRUE)/sqrt(count),
    normality = shapiro.test(`YoungsModulus`)$p.value
  )
SynthesisMatrix
```

Grouping the drug, distance, and collagen compression
```{r}
allStatus <- paste(df_data$MaterialName,df_data$Status.y)
df_data <- cbind(df_data,allStatus)

allStatus_dist <- paste(df_data$allStatus, df_data$Yasix)
df_data <- cbind(df_data,allStatus_dist)
```

#### 1.2. Comparison
```{r}
#pstat_tick<-compare_means(YoungsModulus ~ allStatus,data = df_data, method = "kruskal.test")
#pstat_tick
#skillingsMackTest(df_data$YoungsModulus, groups=df_data$allStatus, blocks=df_data$Yasix)
#Ski.Mack(df_data$YoungsModulus, groups=df_data$allStatus, blocks=df_data$Yasix)

#friedman.test(YoungsModulus ~ allStatus + Yasix | df_data$GroupName.y, data = df_data)

# Run nonparametric analysis
#result <- nparLD(YoungsModulus ~ allStatus * Yasix, data = df_data,
#                 subject = "Experiment Sample", description = TRUE)

# View the summary
#summary(result)
#df_data$allStatus <- factor(df_data$allStatus)
#df_data$allStatus <- relevel(df_data$allStatus, ref = "Control UncompressedWithCell")

# Fit linear mixed-effects model
model_stiff_classic <- lmer(YoungsModulus ~ allStatus*Yasix + (1 | `Experiment Sample`), data = df_data)
model_stiff <- rlmer(YoungsModulus ~ allStatus*Yasix + (1 | `Experiment Sample`), data = df_data)

# Summary of the model
sum_model_stiff <- summary(model_stiff)
sum_model_stiff_classic <- summary(model_stiff_classic)

#gee_model <- geeglm(YoungsModulus ~ allStatus*Yasix , 
#                    id = `Experiment Sample`, 
#                    data = df_data, 
#                    corstr = "ar1")  # or "exchangeable"
#summary(gee_model)
sum_model_stiff_classic
sum_model_stiff
```

[Geniole Shawn N., et al. 2019. Testosterone reduces the threat premium in competitive resource division. 286. Proceedings of the Royal Society B.](http://doi.org/10.1098/rspb.2019.0720) showed the method that the p-value of robust linear mixed model could be calculated by using the degree of freedom from linear mixed model. Robust LMM shares the identical p-value as LMM.

```{r}
#shapiro.test(resid(sum_model_stiff))

# Extract t-values from robust model
t_vals <- sum_model_stiff_classic$coefficients[,"t value"]

# Get approximate degrees of freedom from classic model
# You can use lmerTest or calculate manually

classic_model_df <- coef(summary(model_stiff_classic))[, "df"]

# Compute p-values
p_vals <- 2 * pt(abs(t_vals), df = classic_model_df, lower.tail = FALSE)
p_vals
```


#### 1.3. Post-hoc
```{r}
dun_stif <- df_data %>%
  dunn_test(YoungsModulus ~ allStatus, p.adjust.method="bonferroni")%>%
  filter(p.adj.signif != "ns")


dun_stif$dollarsign <- ifelse(dun_stif$p.adj<=0.0001,"$$$$",
                         ifelse(dun_stif$p.adj<=0.001,"$$$",
                                ifelse(dun_stif$p.adj<=0.01,"$$",
                                       ifelse(dun_stif$p.adj<=0.05,"$","ns"))))

dun_stif$andsign <- ifelse(dun_stif$p.adj<=0.0001,"&&&&",
                         ifelse(dun_stif$p.adj<=0.001,"&&&",
                                ifelse(dun_stif$p.adj<=0.01,"&&",
                                       ifelse(dun_stif$p.adj<=0.05,"&","ns"))))
dun_stif
```


#### 1.2. line plot
```{r fig.width = 10,fig.height = 5, warning=FALSE}
windowsFonts(A = windowsFont("Times New Roman")) 

stiffbox <- ggplot(SynthesisMatrix,aes(x=Yasix, y=mean, color=MaterialName, shape=Status.y))+
  geom_point(mapping = aes(x = Yasix, y = mean), data = SynthesisMatrix, size=4)+
  geom_line(mapping = aes(x = Yasix, y = mean, color=MaterialName, shape=Status.y), data = SynthesisMatrix, size=1)+
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=12)+
  theme_classic()+
  labs( y="Young's modulus (kPa)", x="Distance from the edge of A549 spheroid (mm)")+
  scale_color_discrete(name = "MMP inhibitor", labels=c("Control","GM6001"))+
  theme_bw()+
  border(size = 2)+
  scale_shape_discrete(name = "ECM ", labels=c("Compressed","Uncompressed"))+
  easy_center_title()+
  scale_y_continuous(expand = c(0,0), breaks = seq(0,29,5), limits = c(0,29))+
  scale_x_continuous(breaks = seq(0,200,50))+
  annotate("segment", x = -8, y = 10.6, yend = 23.551261, colour = "black",size = 1)+
  annotate("text", x = -12, y = 16, label = "***",size = 10, angle = 90,family= theme_get()$text[["family"]])+
  annotate("segment", x = -8, y = 9.5, yend = 3.384108, colour = "black",size = 1)+
  annotate("text", x = -12, y = 6.5, label = "*",size = 10,family= theme_get()$text[["family"]])+
  annotate("text", x = 210, y = 6.71, label = "$$",size = 5,family= theme_get()$text[["family"]])+
  theme(
        axis.ticks = element_line(colour ="black",size = 1),
        axis.ticks.length=unit(0.4, "cm"),
        axis.text = element_text(size = 20, face = "bold", color = "black"),
        axis.title.x = element_text(size = 20, face = "bold"),
        axis.title.y = element_text(size=23, face = "bold"),
        legend.position = "None",
        legend.text = element_text(size=15, face = "bold"),
        legend.title = element_text(size=15, face = "bold"),
        plot.title = element_text(size=30, face = "bold"),
        text = element_text(family ="A",size=12),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.key = element_blank()
        )
stiffbox

```

#### 1.3. Save the boxplot for paper

```{r}
ggsave("stiffboxplan.tiff",device = 'tiff', units = "in", width = 10,height = 5 ,dpi = 300)
```

### 2. MMP protein

#### 2.1. EDA
```{r}
df_MMP$allStatus <- paste(df_MMP$MaterialName,"_",df_MMP$Concentration,"uM")

SynthesisMatrix_MMP <- df_MMP[df_MMP$Time_min==1440 | df_MMP$MaterialName=="Control",] %>%
  group_by(MaterialName,Concentration,Time_min,allStatus) %>%
  summarise(
    count = sum(!is.na(`NormalizedMMP1`)),
    N = n_distinct(`GroupName`,na.rm = TRUE),
    mean = mean(`NormalizedMMP1`, na.rm = TRUE),
    sd = sd(`NormalizedMMP1`, na.rm = TRUE),
    median = median(`NormalizedMMP1`, na.rm = TRUE),
    IQR = IQR(`NormalizedMMP1`, na.rm = TRUE),
    se = sd(`NormalizedMMP1`, na.rm = TRUE)/sqrt(count),
    normality = shapiro.test(`NormalizedMMP1`)$p.value
  )
SynthesisMatrix_MMP
```

#### 2.2. Comparison study
```{r}
pstat_MMP<-compare_means(NormalizedMMP1 ~ allStatus,data = df_MMP[df_MMP$Time_min==1440 | df_MMP$MaterialName=="Control",], method = "kruskal.test")
pstat_MMP
```


#### 2.3. Boxplot for 1 day
```{r fig.height= 3.5, fig.width=6}
windowsFonts(A = windowsFont("Times New Roman"))

MMP_plot <-ggplot(data =  df_MMP[df_MMP$Time_min==1440 | df_MMP$MaterialName=="Control",], aes(x=`MaterialName`,y=NormalizedMMP1))+
  geom_boxplot(aes(group=Concentration,fill = Concentration), size=0.8, color="black")+
#  scale_fill_manual(values = c("white","gray40"),name = "",label=c("Glass","Polyacrylamide Gel"))+
#  scale_x_discrete(labels=my_xlab)+
  labs(y="MMP1(<sup>MMP1</sup> / <sub>GAPDH </sub>)<br> normalized to DMSO")+
  scale_y_continuous(expand = c(0,0),limits = c(0,2.5))+
#  stat_pvalue_manual(ifcomp,hide.ns = TRUE, size = 10, tip.length = 0,  step.increase = 0.01,y.position =  c(0.9,1,0.72),family = "A",bracket.size = 1)+
#  stat_pvalue_manual(iftukey_s[5,],hide.ns = TRUE, size = 6, tip.length = 0,  step.increase = 0.01,y.position =  c(0.7),label = "{andsign}",family = "A", bracket.size = 1)+
  theme_bw()+
  border(size = 2)+
  easy_center_title()+  
  theme(axis.ticks.length=unit(0.2, "cm"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.y = element_text(size = 15, color = "black", face = "bold"),
        axis.text.x = element_text(size = 15, color = "black", face = "bold", vjust = 0.5),
        axis.title = element_text(size = 17, face = "bold"),
        legend.text = element_text(size=15, face = "bold"),
        legend.title = element_text(size=15,face = "bold"),
        legend.key = element_blank(),
        plot.subtitle = element_text(size = 20, face = "bold",hjust = 0.5),
        plot.title = element_blank(),
        text = element_text(family ="A"),
        legend.position = "top",
        axis.ticks = element_line(size = 1, colour = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_markdown()
        )

MMP_plot
```
#### 2.4. Save MMP boxplot as TIFF
```{r}
ggsave("MMP.tiff",device = 'tiff', units = "in", width = 6,height = 3.5 ,dpi = 300)
```

### 3. Spheroid with GM6001

#### 3.1. EDA
```{r}
# Select the 7 days culture of spheroids, which made from 1000 cells, on the glass or PA gel
df_data_spheroid_withdrug_GM6001 <-   df_data_spheroid_withdrug[!is.na(df_data_spheroid_withdrug$Drug)&                                (df_data_spheroid_withdrug$Drug==1 |
                                              df_data_spheroid_withdrug$Drug==3),]

# Descriptive statistics
AllMatrix <-  df_data_spheroid_withdrug_GM6001 %>% 
  group_by(`CulturedDate`,`Status`,`MaterialName`,`Concentration`) %>%
  summarise(
    n = n(),
    N = n_distinct(`Group Name.x`,na.rm = TRUE),
    mean = mean(`day5Ratio`, na.rm = TRUE),
    mean2 = mean(`day5Ratio`, na.rm = TRUE),
    sd = sd(`day5Ratio`, na.rm = TRUE),
    median = median(`day5Ratio`, na.rm = TRUE),
    IQR = IQR(`day5Ratio`, na.rm = TRUE),
    se = sd(`day5Ratio`, na.rm = TRUE)/sqrt(n)
  )
colnames(AllMatrix)[which(names(AllMatrix)=="mean2")]<-c("day5Ratio")
AllMatrix
```

#### 3.2. Spheroid Expansion line plot
```{r fig.height= 3.5, fig.width=6}
days <- c(1,2,3,4,5,6,7)
my_xlab <- paste(days)
windowsFonts(A = windowsFont("Times New Roman"))
ingredient.labs <- c("Uncompressed","Compressed")
names(ingredient.labs) <- c("UncompressedWithCell","CompressedWithCell")

growth <- ggplot(df_data_spheroid_withdrug_GM6001,aes(x=CulturedDate, y=day5Ratio, group=MaterialName, shape=MaterialName,color=MaterialName))+
  geom_hline(yintercept = 1.92,linetype="dotted", size=1.4, color="grey50")+
  geom_point(size=0.8)+
  geom_line(aes(group=interaction(Spheroid,MaterialName)),size=0.2,linetype="dotted")+
  geom_point(mapping = aes(x = CulturedDate, y = mean), data = AllMatrix, size=4)+
#  geom_errorbar(aes(ymin=day5Ratio-se, ymax=day5Ratio+se), data = AllMatrix,width=0.5, size=1.1)+
  geom_line(mapping = aes(x = CulturedDate, y = mean, group=MaterialName,linetype=MaterialName), data = AllMatrix, size=1)+
#  geom_text(data = AllMatrix, aes(x = CulturedDate, y = mean, label=paste(round(mean,digits = 0))),parse = TRUE, vjust=-2, size=4,fontface = "bold")+ 
  facet_wrap(~Status, labeller = labeller(Status = ingredient.labs))+
  theme_bw()+
  border(size = 2)+
  labs( y="Expansion Ratio (<sup>Φ<sub>i</sub></sup>/<sub>Φ<sub>1</sub></sub>)", x="Cultured Day"
#        , title = "Spheroid Expansion"
        )+
  scale_y_continuous(expand = c(0,0), limits = c(0.8,2.5), breaks = seq(0,2.5,0.5))+
  scale_x_continuous(labels=my_xlab, breaks = seq(5,11,1))+
#  scale_color_manual(values = c("black","grey40","darkblue"),name = "Collagen Film ",label=c("20% Collagen  ","80% Collagen  ","collagen monomer"))+
#  scale_shape_discrete(name = "Collagen Construct",label=c("Compressed","Uncompressed"))+
#  scale_linetype_discrete(name = "Collagen Construct",label=c("Compressed","Uncompressed"))+
#  scale_color_manual(values = c("black","grey40"),name = "Collagen Film",label=c("20% Collagen","80% Collagen"))+
  scale_color_discrete(name = "MMP inhibitor",label=c("DMSO","GM6001"))+
  scale_shape_discrete(name = "MMP inhibitor",label=c("DMSO","GM6001"))+
  scale_linetype_discrete(name = "MMP inhibitor",label=c("DMSO","GM6001"))+
#  scale_color_discrete(name = "ECM ",label=c("2.5D","Compressed","Glass","3D","Uncompressed"))+
  theme(
#    axis.line = element_line(size = 1, color = "black"),
        axis.ticks = element_line(size = 1, color = "black"),
        axis.ticks.length=unit(0.4, "cm"),
#        prism.ticks.length.y = unit(0.12, "cm"),
        axis.text = element_text(size = 15, color = "black", face = "bold"),
        axis.title = element_text(size = 15, face = "bold"),
        legend.position = "top",
        legend.text = element_text(size=15, face = "bold"),
        legend.title = element_text(size=15, face = "bold"),
        legend.key = element_blank(),
        text = element_text(family ="A"),
        plot.title = element_text(size = 25, face = "bold"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.title.y = element_markdown(),
        strip.text = element_text(size = 15, face = "bold", lineheight = 0.3),
        strip.background = element_rect(size = 2, color = "black"))+
  easy_center_title()

growth
```

#### 3.3. Save Spheroid linplot as TIFF
```{r}
ggsave("GM6001_Spheroid.tiff",device = 'tiff', units = "in", width = 6,height = 3.5 ,dpi = 300)
```

### 4. Thickness

#### 4.1. Longitudinal EDA

##### 4.1.1. Longitudinal
```{r}
thickMatrix <- df_data %>%
  group_by(MaterialName,Status.y,Yasix,allStatus_dist) %>%
  summarise(
    count = sum(!is.na(Thickness)),
    N = n_distinct(`Experiment Sample`,na.rm = TRUE),
    mean = mean(Thickness, na.rm = TRUE),
    sd = sd(Thickness, na.rm=TRUE),
    median = median(Thickness, na.rm=TRUE),
    IQR = IQR(Thickness, na.rm = TRUE),
    se = sd/sqrt(count),
    normality = shapiro.test(`YoungsModulus`)$p.value
  )
thickMatrix
```

##### 4.1.2. Comparison 
```{r}
pstat_tick<-compare_means(Thickness ~ allStatus_dist,data = df_data, method = "kruskal.test")
pstat_tick
```

##### 4.1.3. Post-hoc
```{r}
dun_thick <- df_data[df_data$MaterialName=="Control",] %>%
  dunn_test(Thickness ~ allStatus_dist, p.adjust.method="bonferroni")%>%
  filter(p.adj.signif != "ns")


dun_thick$dollarsign <- ifelse(dun_thick$p.adj<=0.0001,"$$$$",
                         ifelse(dun_thick$p.adj<=0.001,"$$$",
                                ifelse(dun_thick$p.adj<=0.01,"$$",
                                       ifelse(dun_thick$p.adj<=0.05,"$","ns"))))

dun_thick$andsign <- ifelse(dun_thick$p.adj<=0.0001,"&&&&",
                         ifelse(dun_thick$p.adj<=0.001,"&&&",
                                ifelse(dun_thick$p.adj<=0.01,"&&",
                                       ifelse(dun_thick$p.adj<=0.05,"&","ns"))))
dun_thick
```


#### 4.2. Grouping

##### 4.2.1. Grouping EDA
```{r}
thickMatrix_all <- df_data %>%
  group_by(allStatus) %>%
  summarise(
    count = sum(!is.na(Thickness)),
    N = n_distinct(`Experiment Sample`,na.rm = TRUE),
    mean = mean(Thickness, na.rm = TRUE),
    sd = sd(Thickness, na.rm=TRUE),
    median = median(Thickness, na.rm=TRUE),
    IQR = IQR(Thickness, na.rm = TRUE),
    se = sd/sqrt(count),
    normality = shapiro.test(`YoungsModulus`)$p.value
  )
thickMatrix_all
```


##### 4.2.2. Comparison
```{r}
pstat_MMP<-compare_means(Thickness ~ allStatus,data = df_data, method = "kruskal.test")
pstat_MMP
```

##### 4.2.3. Post-hoc
```{r}
dun_all <- df_data %>%
  dunn_test(Thickness ~ allStatus, p.adjust.method="bonferroni")
#  dunn_test(YoungsModulus ~ Yasix, p.adjust.method="bonferroni") %>%
#  dunn_test(YoungsModulus ~ Sample, p.adjust.method="bonferroni") %>%
#  filter(p.adj.signif != "ns") %>%
#  add_xy_position(x="Status.y", group = "Status")
#  add_xy_position(x="Status.y")

#dun_all

dun_all$dollarsign <- ifelse(dun_all$p.adj<=0.0001,"$$$$",
                         ifelse(dun_all$p.adj<=0.001,"$$$",
                                ifelse(dun_all$p.adj<=0.01,"$$",
                                       ifelse(dun_all$p.adj<=0.05,"$","ns"))))

dun_all$andsign <- ifelse(dun_all$p.adj<=0.0001,"&&&&",
                         ifelse(dun_all$p.adj<=0.001,"&&&",
                                ifelse(dun_all$p.adj<=0.01,"&&",
                                       ifelse(dun_all$p.adj<=0.05,"&","ns"))))
dun_all
```


#### 4.3. Lineplot
```{r fig.width = 8.5,fig.height = 4.7, warning=FALSE}
windowsFonts(A = windowsFont("Times New Roman")) 

thickbox <- ggplot(thickMatrix,aes(x=Yasix, y=mean, color=MaterialName, shape=Status.y))+
  geom_point(mapping = aes(x = Yasix, y = mean), data = thickMatrix, size=4)+
  geom_line(mapping = aes(x = Yasix, y = mean, color=MaterialName, shape=Status.y), data = thickMatrix, size=1)+
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=18)+
  theme_classic()+
  labs( y="Thickness(μm)", x="Distance from the edge of A549 spheroid (mm)")+
  scale_color_discrete(name = "MMP inhibitor", labels=c("Control","GM6001"))+
  theme_bw()+
  border(size = 2)+
  scale_shape_discrete(name = "ECM ", labels=c("Compressed","Uncompressed"))+
  easy_center_title()+
  scale_y_continuous(expand = c(0,0), breaks = seq(300,4000,100), limits = c(300,4020))+
  scale_y_break(c(550,3700),scales = 1,ticklabels = c(3700,3850,4000), expand = FALSE)+
  scale_x_continuous(breaks = seq(0,200,50))+
  theme(
        axis.ticks = element_line(colour ="black",size = 1),
        axis.ticks.length=unit(0.4, "cm"),
        axis.text = element_text(size = 18, face = "bold", color = "black"),
        axis.title.x = element_text(size = 18, face = "bold", hjust = 0.4),
        axis.title.y = element_text(size=18, face = "bold"),
        legend.position = "right",
        legend.text = element_text(size=15, face = "bold"),
        legend.title = element_text(size=15, face = "bold"),
        plot.title = element_text(size=30, face = "bold"),
        text = element_text(family ="A",size=12),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.key = element_blank(),
        axis.text.y.right = element_blank(),
        axis.ticks.length.y.right = unit(0,"cm")
  )
thickbox
```
#### 4.4. linplot the thickness lineplot as TIFF
```{r}
ggsave("thickboxplan.tiff",device = 'tiff', units = "in", width = 8.5,height = 4.7 ,dpi = 300)
```

### 5. GM6001 on zymography

#### 5.1. EDA
```{r}
SynthesisMatrix_zym <- df_zym %>%
  group_by(MaterialName,Concentration) %>%
  summarise(
    count = sum(!is.na(`MMP2`)),
    N = n_distinct(`GroupName`,na.rm = TRUE),
    mean = mean(`MMP2`, na.rm = TRUE),
    sd = sd(`MMP2`, na.rm = TRUE),
    median = median(`MMP2`, na.rm = TRUE),
    IQR = IQR(`MMP2`, na.rm = TRUE),
    se = sd(`MMP2`, na.rm = TRUE)/sqrt(count)
#    normality = shapiro.test(`MMP2`)$p.value
  )

SynthesisMatrix_zym
```

#### 5.2. Boxplot for GM6001 zymography
```{r fig.width = 5,fig.height = 3}
windowsFonts(A = windowsFont("Times New Roman"))

zym_plot <-ggplot(data =  df_zym, aes(x=`MaterialName`,y=MMP2, group=`Concentration`, color=`Concentration`))+
  geom_boxplot(aes(group=Concentration,fill = Concentration), size=0.8, color="black")+
  geom_jitter()+
#  scale_fill_manual(values = c("white","gray40"),name = "",label=c("Glass","Polyacrylamide Gel"))+
#  scale_x_discrete(labels=my_xlab)+
  labs(y="MMP2 activity <br> (intensity fold change to DMSO)")+
#  scale_y_continuous(expand = c(0,0),limits = c(0,2.5))+
#  stat_pvalue_manual(ifcomp,hide.ns = TRUE, size = 10, tip.length = 0,  step.increase = 0.01,y.position =  c(0.9,1,0.72),family = "A",bracket.size = 1)+
#  stat_pvalue_manual(iftukey_s[5,],hide.ns = TRUE, size = 6, tip.length = 0,  step.increase = 0.01,y.position =  c(0.7),label = "{andsign}",family = "A", bracket.size = 1)+
  theme_bw()+
  border(size = 2)+
  easy_center_title()+  
  theme(axis.ticks.length=unit(0.2, "cm"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.y = element_text(size = 15, color = "black", face = "bold"),
        axis.text.x = element_text(size = 15, color = "black", face = "bold", vjust = 0.5),
        axis.title = element_text(size = 12, face = "bold"),
        legend.text = element_text(size=15, face = "bold"),
        legend.title = element_text(size=15,face = "bold"),
        legend.key = element_blank(),
        plot.subtitle = element_text(size = 20, face = "bold",hjust = 0.5),
        plot.title = element_blank(),
        text = element_text(family ="A"),
        legend.position = "top",
        axis.ticks = element_line(size = 1, colour = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_markdown()
    )

zym_plot
```

#### 5.3. Save the Zymography
```{r}
ggsave("zymographyWGM6001.tiff",device = 'tiff', units = "in", width = 5,height = 3 ,dpi = 300)
```


### Close and remove channel

```{r}
close(channel)
```
